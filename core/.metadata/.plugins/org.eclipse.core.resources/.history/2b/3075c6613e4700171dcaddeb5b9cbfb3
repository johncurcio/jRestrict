package parser;

import java.util.HashMap;

public class ScriptLexer extends Lexer {
	public static final int EOF = 0;
	public static final int NOME = 1;
	public static final int NUM = 2;
	public static final int WHILE = 3;
	public static final int DO = 4;
	public static final int END = 5;
	
	public static final HashMap<String, Integer> reservadas;
	
	static {
		reservadas = new HashMap<>();
		reservadas.put("while", WHILE);
		reservadas.put("do", DO);
		reservadas.put("end", END);
	}

	public static final String[] nomesToken = new String[] {
			"EOF", "nome", "num", "while", "do", "end"
	};
	
	public ScriptLexer(String _ent) {
		super(_ent);
	}

	public void comentario() {
		match('-');
		match('-');
		while(match(c -> c != Lexer.EOF && c != '\n')) {}
	}
	
	public Token nomeOuReservada() {
		int p = pos;
		while(match(Character::isLetter)) {}
		String t = texto(p);
		if(reservadas.containsKey(t)) return new Token(reservadas.get(t), t, p);
		else return new Token(NOME, t, p);
	}

	public Token num() {
		int p = pos;
		while(match(Character::isDigit)) {}
		String t = texto(p);
		return new Token(NUM, t, p);
	}

	@Override
	public Token proximoToken() {
		while(c != Lexer.EOF) {
			if(c == '-' && peek(1) == '-') {
				comentario();
				continue;
			}
			if(c == ' ' || c == '\n' || c == '\r' || c == '\t') {
				skip();
				continue;
			}
			if(c >= 'a' && c <= 'z') return nomeOuReservada();
			if(c >= '0' && c <= '9') return num();
			Token t = new Token(c, "" + c, pos);
			skip();
			return t;
		}
		return new Token(EOF, "<<EOF>>", pos);
	}

	@Override
	public String nomeToken(int tipo) {
		if(tipo < nomesToken.length) return nomesToken[tipo];
		else return "" + (char)tipo;
	}

}

