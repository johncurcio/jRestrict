package parser;

import java.util.Set;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;

public class Error {
	public int pos = Integer.MAX_VALUE;
	Set<Integer> tipos = new HashSet<>();
	Map<Integer, Integer> recover = new HashMap<>();
	
	public boolean update(int pos, int... tipos) {
		System.out.println("update " + pos + "|" + this.pos + "|" + tipos.length);
		if(pos < this.pos) {
			this.pos = pos;
			this.tipos.clear();
			for(int tipo: tipos) this.tipos.add(tipo);
			return recover.containsKey(pos) && (recover.get(pos) == this.tipos.size());
		} else if(pos == this.pos) {
			for(int tipo: tipos) this.tipos.add(tipo);
			System.out.println("check recover " + pos + "|" + this.tipos.size());
			return recover.containsKey(pos) && (recover.get(pos) == this.tipos.size());
		}
		return false;
	}
	
	public void recover() {
		System.out.println("recover " + pos + "|" + tipos.size());
		recover.put(pos, tipos.size());
		pos = Integer.MAX_VALUE;
		tipos.clear();
	}
}
